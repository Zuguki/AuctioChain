import{r as m,f as E,j as p,N as P,P as I,C as F,D as S}from"./index-de2d1123.js";import{u as y,L as v}from"./useSendDataLot-dfaf43ce.js";import{L as w}from"./LogicDownload-41104aa4.js";import{L as b}from"./LotService-2ef5cf2f.js";import{e as B,a as C}from"./editPageLogic-85e1073c.js";import{u as U}from"./usePostAPI-61665161.js";import{u as h}from"./ImageForm-31ec2828.js";import{u as N}from"./useGetAPI-8a4b8c88.js";import{u as M}from"./useDataUser-7a2b0287.js";import{A as D}from"./AuctionService-80fcdd5a.js";import"./utils-73056672.js";import"./useQuery-baed50f9.js";const V=(o,a)=>{const{initialPrice:s,betStep:t}=o;return{...o,initialPrice:+s,betStep:+t,image:a}},$=o=>{const[a,s]=m.useState(null),{data:t,isLoading:n,error:u}=N(()=>b.getLotByID(o),["lot"]);m.useEffect(()=>{(async()=>{const{id:e,auctionId:l}=t;if(e!=null){const{data:c}=await D.getAuctionByID(l);s(()=>c)}})()},[t.id]),t.id!=null&&D.getAuctionByID(t.auctionId).then(e=>s(()=>e.data));const i=m.useMemo(()=>{const{id:e,currentMaxBet:l,auctionId:c,...L}=t;return e==null?{}:{...L,lotId:e}},[t]),{dataUser:f,logicFormValue:d,setDataUser:g}=M(i);return m.useEffect(()=>{g(()=>i)},[i]),{dataUser:f,logicFormValue:d,loadingLot:n,error:u,baseLot:i,auction:a}},X=()=>{const{id:o}=E();if(o==null)return alert("Ошибка загрузки страницы!"),p.jsx(P,{to:I.main});const{dataUser:a,logicFormValue:s,loadingLot:t,baseLot:n,auction:u}=$(o),{error:i,isPending:f,blurError:d,postData:g}=U(r=>b.updateLot(r)),{setFile:e,postCorrectImage:l,imageFile:c}=h(),{sendData:L}=y(),{userStore:A}=m.useContext(F);if(u){const{userId:r,status:x}=u;if(r!==A.user.userId||x<1||x>2)return alert("Вам отказано в доступе!"),p.jsx(P,{to:I.auctions})}const j=async()=>{const r=await C(a,n,c,d,l);r!==void 0&&await L(()=>g(V(a,r)),S,`${I.lot}/${o}`)};return p.jsx(w,{isLoading:t||B(n,{})||!u,children:p.jsx(v,{submitForm:j,loading:f,error:i,logicFormValue:s,blurError:d,logicFileImage:{setFileImage:e,imageFile:c},componentInteraction:{title:"Правка лота",buttonText:"Отредактировать",component:n}})})};export{X as default};
