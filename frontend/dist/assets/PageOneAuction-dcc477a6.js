import{r as h,C as f,j as s,b as N,P as d,B as u,u as A,o as C,f as v,N as S,H as B}from"./index-de2d1123.js";import{s as t,B as I}from"./BaseListLot-14f2c1cf.js";import{L}from"./LogicDownload-41104aa4.js";import{C as P}from"./CloseButton-e966d2fe.js";import{A as x}from"./AuctionService-80fcdd5a.js";import{L as $}from"./LotService-2ef5cf2f.js";import{u as y}from"./Pagination-da7ae05b.js";import{a as j}from"./AuctionLogic-f40de452.js";import{D as g}from"./DateLogic-542e517c.js";import{u as k}from"./useGetAPI-8a4b8c88.js";import{u as D}from"./useGetUserName-386ae884.js";import{u as F}from"./usePathLocation-e2385006.js";import"./useQuery-baed50f9.js";import"./utils-73056672.js";import"./timeZone-da1aee6f.js";const w=({id:e,auction:o})=>{const[n,i]=h.useState(1),{userStore:l}=h.useContext(f),a=l.user.userId,{data:{lots:r},pagination:c,isLoading:m}=y(()=>$.getLots(e,n),["listLots",n],{lots:[]});return s.jsx(L,{isLoading:m,children:s.jsxs(s.Fragment,{children:[!!r.length&&s.jsxs("p",{className:t.informationLots,children:["Количество лотов: ",c==null?void 0:c.TotalCount]}),a===o.userId&&j.isCreation(o)&&s.jsx("div",{className:t.positionCreateLot,children:s.jsx(N,{to:`${d.createLot}/${e}`,children:s.jsx(u,{children:"Создать лот"})})}),s.jsx(I,{lots:r,pagination:c,setCurrentPage:i})]})})},E=({auction:e})=>{const{description:o,dateStart:n,dateEnd:i}=e;return s.jsxs("div",{className:t.blockInformation,children:[s.jsxs("p",{className:t.information,children:[s.jsx("span",{className:t.description,children:"Дата начала:"})," ",g.getBaseFormatDateToStringISO(n)]}),s.jsxs("p",{className:t.information,children:[s.jsx("span",{className:t.description,children:"Дата окончания:"})," ",g.getBaseFormatDateToStringISO(i)]}),s.jsxs("p",{className:t.information,children:[s.jsx("span",{className:t.description,children:"Статус:"})," ",j.getTextStatus(e.status)]}),s.jsx("p",{className:`${t.information} ${t.description}`,children:"Описание:"}),s.jsx("p",{className:t.information,children:o})]})},T=({auction:e,userId:o,setChangeStatus:n})=>{const{userStore:i}=h.useContext(f),l=A(),a=e.id,r=j.isCreation(e),c=async()=>{try{await x.setNewStatusAuction(a)}catch(p){alert(`Ошибка обновления статуса: ${p}`);return}try{await x.getAuctionByID(a),n(!0)}catch{alert("Ошибка обновления. Попробуйте перезагрузить страницу!")}},m=async()=>{try{await x.deleteAuctionById(a),l(`${d.account}/${o}`)}catch{alert("Ошибка удаления")}};return s.jsx(s.Fragment,{children:i.user.userId===o&&s.jsxs(s.Fragment,{children:[r&&s.jsx("div",{className:t.positionButtonActive,children:s.jsx(u,{onClick:c,children:"Завершить правку"})}),(r||j.isWaitBidding(e))&&s.jsx(u,{red:!0,onClick:m,children:"Удалить аукцион"}),r&&s.jsxs(s.Fragment,{children:[s.jsx("div",{className:t.positionButtonEdit,children:s.jsx(u,{onClick:()=>l(`${d.editAuction}/${a}`),children:"Редактировать аукцион"})}),s.jsx("p",{className:t.informationFinish,children:'Обратите внимание, что торги аукциона начнутся после подтверждения статуса "завершение редактирования" в отдельной странице аукциона. Редактирование доступно только при создании аукциона!'})]})]})})},Y=C(()=>{const{id:e}=v();if(e==null)return alert("Ошибка загрузки страницы!"),s.jsx(S,{to:d.main});const[o,n]=h.useState(!1),{data:i,isLoading:l}=k(()=>x.getAuctionByID(e),["auction",e,o]),{userId:a}=i,{username:r,isLoading:c}=D(a),{fromPath:m}=F(d.auctions);return s.jsxs("div",{children:[s.jsx("div",{className:t.positionClose,children:s.jsx(P,{logicClick:m})}),s.jsxs("div",{className:t.position,children:[s.jsx(L,{isLoading:l||c,children:s.jsxs("div",{children:[s.jsxs("h1",{className:t.title,children:['Аукцион "',i.name,'"']}),s.jsx(N,{className:t.userLink,to:`${d.account}/${a}`,children:s.jsxs("h3",{className:t.userName,children:["@",r]})}),s.jsx(E,{auction:i}),s.jsx(T,{auction:i,userId:a,setChangeStatus:n}),s.jsx(B,{})]})}),s.jsx("h2",{children:"Лоты"})]}),s.jsx(w,{id:e,auction:i})]})});export{Y as default};
